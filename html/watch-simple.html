<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Watch</title>
    <style>
        body {
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        video {
            width: 100%;
            max-width: 1200px;
            margin: 20px auto;
            display: block;
        }
        .info {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .time-info {
            display: flex;
            gap: 40px;
            margin-top: 20px;
        }
        .time-item {
            flex: 1;
        }
        .time-label {
            color: #888;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .time-value {
            font-size: 24px;
            font-weight: bold;
            color: #d4af37;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>Premium Stream</h1>
        <p id="status">Lädt...</p>
    </div>

    <video id="video" controls preload="metadata">
        <!-- Video wird per JavaScript geladen -->
        Dein Browser unterstützt dieses Video-Format nicht.
    </video>

    <div class="info">
        <div class="time-info">
            <div class="time-item">
                <div class="time-label">Aktuelle Zeit</div>
                <div class="time-value" id="currentTime">00:00:00</div>
            </div>
            <div class="time-item">
                <div class="time-label">Gesamtdauer</div>
                <div class="time-value" id="totalDuration">--:--</div>
            </div>
            <div class="time-item">
                <div class="time-label">Verbleibend</div>
                <div class="time-value" id="remaining">--:--</div>
            </div>
            <div class="time-item">
                <div class="time-label">Stream-Dauer</div>
                <div class="time-value" id="streamDuration">00:00:00</div>
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const status = document.getElementById('status');

        // Video-Stream-URL setzen (relativ)
        const videoStreamUrl = '/videos/ttr.m4v';
        console.log('Lade Video-Stream von:', window.location.origin + videoStreamUrl);
        video.src = videoStreamUrl;
        video.load();
        
        console.log('Video src:', video.src);
        console.log('Video currentSrc:', video.currentSrc);

        // Video-Events
        video.onloadstart = () => {
            status.textContent = '⏳ Video lädt...';
            console.log('Video lädt...');
        };

        video.onloadedmetadata = () => {
            status.textContent = '✅ Video geladen!';
            console.log('Metadaten geladen');
            console.log('Dauer:', video.duration);
            console.log('Video bereit:', video.readyState);
            
            // Zeige Gesamtdauer
            if (video.duration && !isNaN(video.duration) && isFinite(video.duration)) {
                const mins = Math.floor(video.duration / 60);
                const secs = Math.floor(video.duration % 60);
                document.getElementById('totalDuration').textContent = 
                    `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            } else {
                // Fallback: Zeige geschätzte Dauer basierend auf Dateigröße
                document.getElementById('totalDuration').textContent = '~42:30';
                console.log('Dauer nicht verfügbar, verwende Schätzung');
            }
            
            // Versuche Autoplay
            video.play().then(() => {
                status.textContent = '▶️ Video spielt';
            }).catch(e => {
                status.textContent = '⏸️ Klicke Play zum Starten';
                console.log('Autoplay blockiert:', e);
            });
        };

        // Zusätzlicher Event für wenn Dauer verfügbar wird
        video.ondurationchange = () => {
            console.log('Dauer geändert:', video.duration);
            if (video.duration && !isNaN(video.duration) && isFinite(video.duration)) {
                const mins = Math.floor(video.duration / 60);
                const secs = Math.floor(video.duration % 60);
                document.getElementById('totalDuration').textContent = 
                    `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }
        };

        video.onerror = (e) => {
            status.textContent = '❌ Fehler beim Laden';
            console.error('Video-Fehler:', e);
            console.error('Quelle:', video.currentSrc);
        };

        video.ontimeupdate = () => {
            const remaining = video.duration - video.currentTime;
            const mins = Math.floor(remaining / 60);
            const secs = Math.floor(remaining % 60);
            document.getElementById('remaining').textContent = 
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        };

        // Aktuelle Zeit
        function updateTime() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            const s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('currentTime').textContent = `${h}:${m}:${s}`;
        }

        // Stream-Dauer (seit Seitenaufruf)
        const startTime = Date.now();
        function updateStreamDuration() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const h = Math.floor(elapsed / 3600);
            const m = Math.floor((elapsed % 3600) / 60);
            const s = elapsed % 60;
            document.getElementById('streamDuration').textContent = 
                `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        setInterval(updateTime, 1000);
        setInterval(updateStreamDuration, 1000);
        updateTime();
        updateStreamDuration();

        console.log('Video-Element:', video);
        console.log('Video-Quelle:', video.currentSrc || 'Noch nicht geladen');
    </script>
</body>
</html>
